

## 项目背景

DODO是一个由主动做市商（PMM）算法驱动的去中心化交易平台。它的特点是具有高资本效率的流动性池，支持单边代币的流动性提供，减少无常损失，并能最小化交易时的滑点。DODO还提供SmartTrade - 这是一种去中心化的流动性聚合器服务，可以寻找并智能路由到各种流动性来源，以报出任意两个代币之间的最优价格。此外，DODO还消除了建立新资产流动性池的各种限制，可自由定义和实时调整资产比例，流动性深度，手续费率等。最大限度的降低了新资产发行的门槛。基于此，DODO开发了众筹建池（一个无需许可、机会均等的流动性发放机制）以及面向专业链上做市商的可定制化灵活技术解决方案。

DODO的去中心化交易所产品套件包括智能聚合交易、众筹建池/新资产流动性发行、资金池和挖矿（包括流动性挖矿、交易挖矿和联合挖矿）。它集成了各种钱包应用，用户可以通过这些应用与平台互动。

- **智能聚合交易:**

DODO基于Ethereum和币安智能链(BSC)构建，可以实现同一网络上两个任意代币之间的交易。它能智能地从流动性来源中找到最佳的订单路由，为交易者提供最佳的价格和最低的滑点。在DODO上执行交易的用户还可以选择参与交易挖矿，获得DODO代币奖励。

- **众筹建池：**

众筹建池是一种平等机会的分配代币和启动流动性市场的方式。受证券市场上常见的打新机制的启发平等机会确保了没有科学家抢跑和机器人的干扰。在流动性保护期提供的额外安全保障下，用户可以安心参与流动性发行活动，切实地支持自己喜欢的项目。

- **做市：**

DODO通过DODO公有池和DODO私有池，让流动性提供者可以灵活地创建和管理自己的做市策略。这是一个全程完全无需许可、非托管的过程，用户有权配置自己池子的各种参数，以建立具有适合其需求的理想定价曲线的流动性市场。

- **挖矿：**

除了上述的交易挖矿和传统的流动性挖矿外，池子创建者和流动性提供者还可以通过参与联合挖矿，让DODO平台用户随时接触到有趋势、有前景、愿意与DODO合作的项目。通过审核的项目可以在DODO上创建流动性池，这些池子的流动性提供者能获得DODO代币奖励。

- **主动做市商算法：**

主动做市商算法 PMM 是一种新的链上做市模型。它有别于非恒定函数做市商模式，将交易对资产关系拆离开来。可以灵活的设置资产配比、曲线斜率等参数。同时也可以引入预言机来指导价格或链上由市场进行价格发现。它将更多资金聚集在市价附近，提供充足的流动性。



## 技术细节

* 基于PMM算法

  一个有效的市场包含巨量信息，这些信息承载了市场对价格的判断。但是链上计算资源有限，在链上实现一个高度灵活的市场，就好像要把大象塞进冰箱。把大象塞冰箱这种事情并不罕见，互联网历史上已经有过几次壮举。例如图像压缩，音频压缩。

  压缩的本质是提取最重要的特征，抛弃不重要的细节信息。那么，一个市场最重要的特征是什么，是流动性。流动性可以表示为一张深度图。

  ![pmm_1](https://dodoex.github.io/docs/img/pmm_1.png)

  

  从下图我们看到，深度图可以抽象为两个三角形，而描述这两个三角形，只需要中间价和斜率即可。![pmm_2](https://dodoex.github.io/docs/img/pmm_2.png)

  我们盯住右边的卖盘梯形深度，它的最大特点是，被买走的Base Token越多，价格越高。因此，这种线性深度可以表示为：
  $$
  P = i + ik(\frac{B_0-B}{B_0})
  $$

  其中 i 是第一个参数 "中间价"，k是第二个参数 "斜率", B表示当前的Base Token库存，B0表示初始Base Token库存，(B0-B)/B0用来表示有百分之多少的BaseToken被消耗掉了。

  这一公式可以使得价格随着Base Token被卖出的数量线性增长。

  但是，线性真的是描述流动性最好的方法吗？并不是，线性描述有两个局限：

  1. 真正的市场，大部分流动性集中市场中间价附近，而线性描述并没有反应这种不平衡的分布；
  2. 即使价格远远偏离市场中间价，也应该有流动性，而线性描述下的价格是有上下限的

  我们为价格曲线引入了非线性。在不扩充参数的前提下，使深度分布更符合市场规律，灵活度更高。

  ![](https://dodoex.github.io/docs/img/pmm_3.png)

  最简单的非线性解决方案，就是使用乘法而非加法：
  $$
  P = i(\frac{B_0}{B})
  $$


  这个公式可以满足随着B的减小，P不断增大，直至无穷大。但是要怎么把斜率的影响加进去呢？这就需要对B0/B这一项做改造了。B0/B≥1，我们用一个参数对其进行缩放，在保持此数值大于等于1的同时，可以控制它"大于1的程度"。
  $$
  P = i(1-k + k\frac{B_0}{B})
  $$

  上式中，k的取值范围是[0,1]，决定了价格的斜率。

  - 当k=0时，价格完全不变
  - 当k=1时，价格斜率退化到上一个版本的公式
  - k越大，价格变化越敏感。k越小，价格变化越不敏感

  但是还有一个小问题，这里的P是边际价格，对边际价格的积分才是用户需要支付的资产数量。上式中，B0/B这项积分后出现了对数函数，这会使后续计算变得很复杂。为了避免这一麻烦，我们再进一步：
  $$
  P = i(1-k + k(\frac{B_0}{B}^2))
  $$
  在B0/B外面加一个平方项，这样积分后就变成了一个简单的除法。

  令人惊叹的是，当k=1时，这条曲线正是AMM所定义的bonding curve。这种巧合使我们相信，这是一套更加触及市场本质的算法。

  同理，对于左半边的深度图，我们用对称的做法，将base token替换为quote token，将乘法替换为除法：
  $$
  P=i/(1-k+(\frac{Q_0}{Q})^2k)
  $$

  我们将左右两边的深度图结合起来，就得到了PMM算法的完全版本，整理一下：

  PMM 的价格曲线对应的公式为:
  $$
  P_{margin}=iR
  $$
  R 由以下公式决定
  $$
  if B<B_0, then R=1-k+(\frac{B_0}{B})^2k \\
  if Q<Q_0, then R=1/(1-k+(\frac{Q_0}{Q})^2k) \\
  
  else R=1
  $$

  PMM算法是对Orderbook市场的高度压缩，参数简单，却极度灵活。这使得我们在冰箱如此狭小的空间内，拥有了堪比大象的能力。

* 设计了私人池（DPP）和公共池（DVM）

* 众筹建池。一种平等机会的分配代币和启动流动性市场的方式。受证券市场上常见的打新机制的启发平等机会确保了没有科学家抢跑和机器人的干扰。在流动性保护期提供的额外安全保障下，用户可以安心参与流动性发行活动，切实地支持自己喜欢的项目。

* 引入vDODO 作为会员证明 (proof of membership)。 创新了项目代币的激励方式。

* 智能合约框架![dodo_framework_v2](https://dodoex.github.io/docs/img/dodo_framework_v2.png)



## 当前进度

* DODO V1：仅支持普通池，采用PMM算法。

* 更新了 DODO V2, 设计了DPP池，DVM池，新增众筹建池功能，引入vDODO会员机制

* 智能路由，聚合不同DAPP的报价。

  ![7471f206ecf403590b9b2412ace202884bf87718](https://aws1.discourse-cdn.com/standard14/uploads/dodoex/original/1X/7471f206ecf403590b9b2412ace202884bf87718.png)

## 技术难点与解决方案

* EVM兼容性问题

  依据Moonbeam的特性，在不改动交易逻辑的前提下修改合约，使其适配

* 聚合链上数据到the graph，并进行数据展示

  整理了一个较为精简的前端，后续再逐步测试、增加功能

## 黑客松时间内进度

* 更新了DODO V2，测试并上线了一些新的资产功能：众筹建池、升价拍卖、固定价格发行、自定义联合曲线发行。
* 迁移到了BSC链上；初步测试了Moonbeam的环境。
* 与Wootrade合作，引入了机构投资者作为报价池来源
* 成功解决了一次黑客攻击