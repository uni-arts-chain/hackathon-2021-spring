###  **​DeFi世界对预言机服务的需求**

随着开放金融 - DeFi的发展繁荣，为DeFi提供数据服务的预言机的作用越来越得到了体现。预言机作为区块链的底层基础设施的重要性在一次次的DeFi攻击性事件中得到了验证。

回顾DeFi的发展路程，从第一代产品MakerDAO里面，我们已经看到了预言机的影子，MakerDAO用预言机获取到的价格来标定价格，以此来释放稳定币DAI，Compound将我们带到了DeFi第二代产品，这个声称要做数字世界银行的DeFi应用，带来了流动性挖矿，通过质押数字资产带来流动性来获取收益，其中的借贷功能需要获得资产的实时价格作为资产的定价和清算标准。下面我们看一张图：
<div style="align: center">
<img src="https://img-blog.csdnimg.cn/20210219160823390.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0FyZXNfUHJvdG9jb2w=,size_16,color_FFFFFF,t_70"/>
</div>
<center>TVL($USD)排名前十的DeFi类项目</center>
<p/>

上面所列的DeFi项目中，绝大多数都或多或少的使用了预言机服务，预言机的需求呈指数级增长，这也是为何Chainlink能到达市值前10位置的原因。

### **预言机的发展与Rollup技术的结合**

区块链是一个封闭的环境，链上是无法主动获取链外真实世界的数据，所以区块链需要预言机来满足对外界数据交互的需求。预言机是区块链世界中的数据代理商，负责查找和验证真实世界的数据，并以加密的方式将信息提交给区块链系统。

Vitalik 在《回顾区块链近 5 年经济学进展，以及新出现的问题》一文中，将预言机问题的重点放在了获取真实数据上。可见如何确保数据的真实有效是预言机需要解决的一大难题，回顾Layer2的发展历程，从最开始雷电网络的状态通道，到Plasma的子链，再到强调链上验证的Rollup，以太坊一直在追逐数据的安全可靠。

我们再来看下预言机的发展流程，通过治理中心化实现的Chainlink，到强调报价节点随机性的Band、DOS等区块链网络，Ares Protocol从之前优秀的预言机方案中汲取营养，在保证报价数据随机性的同时结合了`Optimistic Rollup`的乐观挑战模型，设计了通过链上验证来确认数据安全可信的机制。

Ares Protocol结合了Optimistic Rollup数据验证模型，并且在`Optimistic Rollup的基础上，兼收并蓄Rollup方案先进的数据验证优势。Ares开发者深耕在以太坊技术社区，通过对比各种技术设计，考虑到验证每一个数据的复杂度，最终选择理论借鉴Optimistic Rollup的乐观挑战模型，假设全网只要有一个诚实挑战者，即可验证链上数据的真实可靠。`

以太坊已经确认了以 Rollup 为中心的 2.0 路线图，而Optimistic Rollup正是以太坊Rollup扩容方案的主力军，Optimistic Rollup 是2021 年以太坊生态至关重要的技术之一。

`作为跨链预言机世界的Rollup，Ares Protocol将吸收以太坊社区Rollup方案的优秀设计经验， 将目前最高安全级别的链上验证机制带入到预言机领域，将真实可信的数据从中心化机构带入到去中心化的节点领域，从而打造顶尖质量的预言机解决方案。`

### **Ares Protocal的架构设计与具体功能**

Ares Protocol的架构设计中包含如下几部分：

![在这里插入图片描述](https://img.learnblockchain.cn/2021/02/22_/283898729.png)

* 分布式数据源，

* 随机的报价矿工，

* 矿工声誉系统，

* 时刻验证数据的挑战者，

* 仲裁机构：网络安全的守护者。

![在这里插入图片描述](https://img.learnblockchain.cn/2021/02/22_/253073500.png)

`一级价格过滤：`

正常情况下，报价矿工会处理网络上的价格请求，矿工与分布式数据源进行加密链接从而获取价格，并将价格按聚合算法提交到链上，这是一级价格过滤。

`二级价格过滤：`

当链上收集够足够的矿工报价后，会通过聚合算法剔除掉非法数据并生成可用的价格，这是二级价格过滤。

`三级价格过滤：`

正常情况下流程到此已经结束，当网络中出现恶意报价矿工时，挑战者将发起价格挑战，将恶意报价数据和真实数据传递到`仲裁机构`。

仲裁机构中的仲裁成员一般为声誉值较高的矿工，仲裁成员在收到价格挑战时，向自身连接的分布式数据源提出请求，去查询价格的正确性并给出自己的投票结果。

最后拿到结果后如果挑战成功，将惩罚恶意报价的节点，罚没矿工一大部分质押资产，并将其从报价矿工成员中剔除。罚没的一部分金额将给予挑战者和仲裁机构作为奖励，还有一部分会流入国库，对于造成价格损失的DeFi使用方进行数据补偿。这是价格的3级过滤。

#### **Ares Protocol的具体功能是什么？**

下面将列举Ares Protocol中使用的具体功能点和功能比较：

![在这里插入图片描述](https://img.learnblockchain.cn/2021/02/22_/953106009.png)
<center>Ares Protocol与当今市场热门预言机的功能比较</center>

<p/>


* `Reputation POS机制`

Ares通过引入RPOS机制 （Reputation POS），让普通用户也可参与到节点运营商里面，通过Staking经济来管理广大节点的行为，诚实运行节点的运营商可以积累声誉值，Reputation POS将和可验证随机函数（VRF）结合，声誉值的增加可以获得更多的出块权重，通过POS的一整套流程来保证节点网络的安全。

* `报价节点随机性`

报价节点的可预测性会影响到网络激励的分配。EOS网络出块被诟病的其中一大原因是21个节点轮流出块，出块节点很容易被预测到，这是DeFi难以在EOS爆发的原因，Ares基于Polkadot网络与Substrate区块链架构构建，因此借助BABE共识算法，便捷地使用VRF功能进行随机选择报价的节点，让报价节点被预测的可能变得几乎为零。

* `仲裁联盟管理节点安全性`


当报价节点将分布式数据源的数据提交到链上，在真实的拜占庭环境下，任何节点处于自身的利益都有作恶的可能，对作恶节点如何惩罚和对诚实的节点错误惩罚考验着区块链系统的设计，当挑战者检测到网络内存在恶意报价节点，可以通过类似DAO的联盟来做链上惩罚。建立仲裁联盟将在保持去中心化的同时兼顾链上治理的效率。联盟内的仲裁成员通过自发验证数据有效性然后对数据发起投票，可以极大地提高网络安全性。

* `预言机价格上链无延迟问题`

在区块链资产中，价格时刻都在发生着变化，当价格波动大的时候，需要频繁提交价格更新到链上，对于复杂的区块链系统来说，由于承载的DeFi项目众多，这个时候链上存在大量因价格变动而自动触发的交易。当交易量大的时候GAS值会暴涨，此时发送的交易由于GAS费的原因可能无法及时上链，然后全市场推高的GAS费要求使得一些价格信息最终无法上链，这样循环往复，会造成巨大的价格延迟。Chainlink曾因巨大的市场波动发生过六个小时内未更新ETH/USD价格，导致了巨大的市场恐慌，Ares通过将矿工和报价进行绑定，可以保证预言机价格的实时上链，不会发生类似的价格延迟问题。

* `链上结合链下数据筛选`


目前市面上有些预言机依附以太坊网络，报价节点无共识，这带来了一些网络安全性的问题，Ares通过BABE共识算法和Offchain worker（链下工作机）的结合，利用了Polkadot的两大创新，使价格的获取更加的去中心化和安全，通过Offchain worker来安全地访问链下真实世界的数据，然后再将数据通过签名传递到Wasm（WebAssembly）智能合约里，真正实现了数据的安全获取，Ares会将从链下获取的数据与链上的数据做整合，剔除掉一些恶意数据，将真实有效的数据做链上数据聚合，实现了数据的二次过滤。

* `Wasm合约的优越性`

当前大部分预言机都基于以太坊生态构建，EVM兼容性不足，256位的机器码极大地影响了性能，通过引入Wasm，可以提升数据执行的效率，为在浏览器上直接运行提供了可能，借助于Wasm的优秀性能和多样的数据接口，能定义出兼容性和可视化的数据结构，我们可以构建出一个功能强大的预言机模块。

* `可升级的自适应适配器`

立足于面向数字经济发展提供数据层面，我们需要不同类型的适配器来解析数据，数字世界数据千差万别，在网络启动的时候只能解析一部分数据，而通过波卡的链上升级，可以根据外部世界的需求，不断更新数据适配器，将优质的链上数据带入链上世界，真正实现Web3的宏大愿景。

* `去中心化的聚合式数据源`

在数据源方面，Ares使用分布式的数据源来获取价格，每个数据源都不只是简单的获取交易所的价格，而是会将一些行情网站的数据做聚合，因为行情网站已经提取了各个交易所的价格，将行情网站的价格做聚合获得的结果更加真实。在分布式数据源和报价节点之间的交互上，Ares使用了ECDHE临时椭圆曲线DH秘钥交换协议来保证数据更加安全。

**Ares Protocol将在波卡和以太坊两大平台同时上线，通过跨链和衍生品协议实现数据和资产的交互，打造跨链预言机世界的Rollup。**
